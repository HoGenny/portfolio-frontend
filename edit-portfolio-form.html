<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í¬íŠ¸í´ë¦¬ì˜¤ í¼ ìˆ˜ì •</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 2rem; background: #f9fafb; }
    label { font-weight: 600; display: block; margin-top: 1rem; }
    input, textarea { width: 100%; padding: 0.6rem; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; margin-top: 0.3rem; }
    button { margin-top: 1.5rem; padding: 0.8rem 1.5rem; font-size: 1rem; background: #3182f6; color: white; border: none; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì • (í¼ ê¸°ë°˜)</h2>
  <form id="edit-form">
    <label>ì´ë¦„</label>
    <input type="text" id="name" required />

    <label>í•œì¤„ ì†Œê°œ</label>
    <input type="text" id="bio" />

    <label>ê¸°ìˆ  ìŠ¤íƒ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" id="skills" />

    <label>í”„ë¡œì íŠ¸ ì—¬ì • (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
    <textarea id="projects" rows="5"></textarea>

    <label>ì´ë©”ì¼</label>
    <input type="email" id="email" />

    <label>GitHub ë§í¬</label>
    <input type="url" id="github" />

    <label>ë¸”ë¡œê·¸ ë§í¬</label>
    <input type="url" id="blog" />

    <label>ë§ˆë¬´ë¦¬ ë¬¸ì¥</label>
    <input type="text" id="message" />

    <button type="submit">ì €ì¥í•˜ê¸°</button>
  </form>

  <script>
    const API_BASE = "https://portfolio-backend.onrender.com"; // â† Render URLë¡œ ë°”ê¿”ì¤˜
  
    const params = new URLSearchParams(location.search);
    const filename = params.get("file");
  
    if (!filename) {
      alert("íŒŒì¼ëª…ì´ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      history.back();
    }
  
    // í¬íŠ¸í´ë¦¬ì˜¤ HTMLì„ ë¶ˆëŸ¬ì™€ í•„ë“œì— ì±„ì›€
    fetch(`${API_BASE}/api/portfolios/${filename}`)
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
  
        document.getElementById("name").value = doc.querySelector(".hero h1")?.textContent.replace("ì½”ë“œë¥¼ ëª¨í—˜í•˜ë‹¤, ", "").replace("ì…ë‹ˆë‹¤.", "") || "";
        document.getElementById("bio").value = doc.querySelector(".hero p")?.textContent || "";
        document.getElementById("skills").value = Array.from(doc.querySelectorAll(".tags span")).map(el => el.textContent).join(", ");
        document.getElementById("projects").value = Array.from(doc.querySelectorAll(".timeline-item")).map(el => el.textContent).join("\n");
        document.getElementById("email").value = doc.querySelector("a[href^='mailto:']")?.getAttribute("href")?.replace("mailto:", "") || "";
        document.getElementById("github").value = doc.querySelector("a[href*='github']")?.href || "";
        document.getElementById("blog").value = doc.querySelector("a[href*='blog']")?.href || "";
        document.getElementById("message").value = doc.querySelector(".footer p")?.textContent || "";
      });
  
    document.getElementById("edit-form").addEventListener("submit", async function (e) {
      e.preventDefault();
  
      const name = document.getElementById("name").value;
      const bio = document.getElementById("bio").value;
      const skills = document.getElementById("skills").value.split(',').map(s => s.trim());
      const projects = document.getElementById("projects").value.split('\n').filter(Boolean);
      const email = document.getElementById("email").value;
      const github = document.getElementById("github").value;
      const blog = document.getElementById("blog").value;
      const message = document.getElementById("message").value;
  
      const html = `
  <!DOCTYPE html>
  <html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${name}ì˜ í¬íŠ¸í´ë¦¬ì˜¤</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; }
    section { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; scroll-snap-align: start; text-align: center; padding: 2rem; }
    .section-title { font-size: 2rem; color: #3182f6; margin-bottom: 1rem; }
    .tags span, .skills div, .quests div { margin: 0.4rem; padding: 0.6rem 1rem; background: #eff6ff; border-radius: 10px; }
    a { color: #3182f6; text-decoration: none; margin: 0 0.5rem; }
  </style></head><body>
    <section class="hero"><h1>ì½”ë“œë¥¼ ëª¨í—˜í•˜ë‹¤, ${name}ì…ë‹ˆë‹¤.</h1><p>${bio}</p></section>
    <section><div class="section-title">ê°œë°œì DNA</div><div class="tags">${skills.map(s => `<span>${s}</span>`).join("")}</div></section>
    <section><div class="section-title">í”„ë¡œì íŠ¸ ì—¬ì •</div>${projects.map(p => `<div class="timeline-item">${p}</div>`).join("")}</section>
    <section><div class="section-title">ğŸ“¬ ë‚˜ì™€ ì—°ê²°í•˜ê¸°</div>
      <div class="links">
        <a href="mailto:${email}">ì´ë©”ì¼</a>
        ${github ? `<a href="${github}" target="_blank">GitHub</a>` : ""}
        ${blog ? `<a href="${blog}" target="_blank">ë¸”ë¡œê·¸</a>` : ""}
      </div>
    </section>
    <section class="footer"><p>${message}</p></section>
  </body></html>`;
  
      const response = await fetch(`${API_BASE}/api/portfolios/${filename}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ html })
      });
  
      const result = await response.json();
      alert(result.message);
      window.location.href = `${API_BASE}/portfolios/${filename}`;
    });
  </script>
  
</body>
</html>
